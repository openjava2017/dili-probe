plugins {
    id 'java'
}

group 'org.openjava.probe'
archivesBaseName = 'openjava-probe'
version '1.0'

sourceCompatibility = '11'
targetCompatibility = '11'

repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    implementation 'org.ow2.asm:asm:9.4'
    implementation 'org.ow2.asm:asm-commons:9.4'
    testCompileOnly 'javax.servlet:javax.servlet-api:4.0.1'
}

jar {
    manifestContentCharset 'utf-8'
    metadataCharset 'utf-8'
    manifest {
        attributes "Main-Class" : "org.openjava.probe.agent.TestProbeAgent"
        attributes "Can-Redefine-Classes" : true
        attributes "Can-Retransform-Classes" : true
        attributes "Premain-Class" : "org.openjava.probe.agent.ProbeAgent"
        attributes 'Class-Path': configurations.compileClasspath.files.collect {"$it.name"}.join(' ')
    }
    from { // 打包test类
        sourceSets.test.output
    }
}

test {
}

task copyJars(type: Copy) { // 将依赖包拷贝至build/libs下
    from configurations.compileClasspath
    into "$buildDir\\libs"
}

build {
    dependsOn copyJars
}
